---
name: sync-manifest
description: Regenerate masque manifest files for fast listing
arguments:
  - name: scope
    description: "Which manifests to sync: 'private', 'shared', or omit for both"
    required: false
---

# Sync Manifest Command

Regenerate manifest files containing summary data for fast `/list` lookups.

## Overview

Manifests are pre-built YAML files containing the summary fields needed for listing masques. This avoids reading every `*.masque.yaml` file on each `/list` call.

## Manifest Locations

- **Private**: `${MASQUES_HOME:-~/.masques}/manifest.yaml`
- **Shared**: `${CLAUDE_PLUGIN_ROOT}/personas/manifest.yaml`

## Instructions

1. **Determine scope** from the argument:
   - No argument: sync both private and shared
   - `private`: sync only `${MASQUES_HOME:-~/.masques}/manifest.yaml`
   - `shared`: sync only `${CLAUDE_PLUGIN_ROOT}/personas/manifest.yaml`

2. **For each location in scope**, generate a manifest:

   a. **Glob** for `*.masque.yaml` files in the directory

   b. **For each masque file**, extract:
      - `name` - Display name
      - `version` - Version string
      - `attributes.domain` - Domain area
      - `attributes.tagline` - Brief description (fallback to `attributes.philosophy` if no tagline)

   c. **Sort entries** by name (case-insensitive)

   d. **Write manifest** with this format:

   ```yaml
   # Auto-generated by /sync-manifest - do not edit manually
   generated_at: 2026-01-26T15:42:00Z
   masques:
     - name: Codesmith
       version: "0.1.0"
       domain: systems-programming
       tagline: "every line should teach"
     - name: Mirror
       version: "0.1.0"
       domain: masque-creation
       tagline: "who do you need to become?"
   ```

3. **Report results**:

   ```
   Manifest sync complete:

   Private (~/.masques/manifest.yaml):
     2 masques indexed

   Shared (personas/manifest.yaml):
     4 masques indexed
   ```

   If a directory has no masque files:
   ```
   Private (~/.masques/manifest.yaml):
     No masques found, manifest not created
   ```

## Edge Cases

- If `${MASQUES_HOME:-~/.masques}` directory doesn't exist, report and skip
- If a masque file is malformed, warn but continue with others
- Overwrite existing manifest files without prompting
