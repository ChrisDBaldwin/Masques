services:
  audience:
    build: .
    image: masques-audience
    container_name: masques-audience
    env_file:
      - path: .env
        required: false
    environment:
      # Defaults if .env is missing â€” collector starts but ClickHouse export
      # retries silently until configured. See .env.example.
      - CLICKHOUSE_ENDPOINT=${CLICKHOUSE_ENDPOINT:-http://localhost:8123}
      - CLICKHOUSE_DATABASE=${CLICKHOUSE_DATABASE:-otel}
      - CLICKHOUSE_USER=${CLICKHOUSE_USER:-default}
      - CLICKHOUSE_PASSWORD=${CLICKHOUSE_PASSWORD:-}
    volumes:
      - ./data:/data
    ports:
      - "0.0.0.0:4317:4317"   # gRPC
      - "0.0.0.0:4318:4318"   # HTTP
      - "0.0.0.0:13133:13133" # Health check
    restart: unless-stopped
