# Manifest-Based Masque Listing

## Problem

`/list` currently globs and reads every `*.masque.yaml` file to produce a table. This is wasteful - 6+ file reads for a simple listing.

## Solution

Pre-built manifests that contain the summary fields needed for listing. A `/sync-manifest` command regenerates them on demand.

## Manifest Format

Each masques directory gets a `manifest.yaml`:

```yaml
# Auto-generated by /sync-manifest - do not edit manually
generated_at: 2026-01-26T15:42:00Z
masques:
  - name: Mirror
    version: "0.1.0"
    ring: player
    domain: masque-creation
    tagline: "who do you need to become?"
  - name: Codesmith
    version: "0.1.0"
    ring: player
    domain: systems-programming
    tagline: "every line should teach"
```

Locations:
- `~/.masques/manifest.yaml` (private)
- `personas/manifest.yaml` (shared)

## `/sync-manifest` Command

Behavior:
1. Glob `*.masque.yaml` in target directory
2. For each file, extract: `name`, `version`, `ring`, `attributes.domain`, `attributes.tagline` (fallback to `attributes.philosophy`)
3. Sort entries by `name` (alphabetical, case-insensitive)
4. Write `manifest.yaml` with `generated_at` timestamp

Arguments:
- `/sync-manifest` - syncs both locations (private + shared)
- `/sync-manifest private` - syncs only `~/.masques/`
- `/sync-manifest shared` - syncs only `personas/`

Output:
```
✓ Synced ~/.masques/manifest.yaml (2 masques)
✓ Synced personas/manifest.yaml (4 masques)
```

## Updated `/list` Command

New behavior:
1. Read `~/.masques/manifest.yaml` (private) - if exists
2. Read `personas/manifest.yaml` (shared) - if exists
3. Merge entries, tagging each with source (`[private]` / `shared`)
4. If name collision, private wins
5. Check for active masque symlink
6. Render table

Fallback if no manifest:
```
No manifest found. Run /sync-manifest to generate.
```

## Files to Create/Modify

Create:
- `commands/sync-manifest.md`

Modify:
- `commands/list.md`
- `CLAUDE.md`

Generate:
- `personas/manifest.yaml`
- `~/.masques/manifest.yaml`
