# Masque Schema v0.1
# Formal definition of the masque YAML structure
#
# A masque is a temporary cognitive identity bundling five components:
# intent, context, knowledge, access, and lens.

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://masques.ai/schemas/masque.schema.yaml"
title: Masque
description: A temporary cognitive identity for agents

type: object
required:
  - name
  - index
  - version
  - ring
  - intent
  - lens

properties:
  # === Identity ===
  name:
    type: string
    description: Human-readable name for this masque
    minLength: 1

  index:
    type: integer
    description: Unique numeric identifier
    minimum: 1

  version:
    type: string
    description: Semantic version (e.g., "0.1.0")
    pattern: "^\\d+\\.\\d+\\.\\d+$"

  # === Metadata ===
  ring:
    type: string
    description: Trust ring required to assume this masque
    enum: [admin, player, guest, outsider]

  attributes:
    type: object
    description: Flexible key-value metadata
    additionalProperties: true

  # === Skills ===
  skills:
    type: array
    description: References to external skill definitions
    items:
      type: object
      required: [uri, level]
      properties:
        uri:
          type: string
          description: Skill URI (e.g., skill://programming/zig)
          pattern: "^skill://[a-z0-9-]+/[a-z0-9-]+$"
        level:
          type: string
          enum: [novice, competent, proficient, expert, master]
          description: |
            Claimed proficiency level:
            - novice: Learning, needs guidance
            - competent: Can do standard tasks independently
            - proficient: Handles complex cases, teaches others
            - expert: Deep mastery, defines best practices
            - master: Shapes the field, creates new approaches

  # === The Five Components ===

  intent:
    type: object
    description: What this masque can and cannot do
    properties:
      allowed:
        type: array
        items:
          type: string
        description: Glob patterns for allowed intents
      denied:
        type: array
        items:
          type: string
        description: Glob patterns for denied intents

  context:
    type: string
    description: |
      Domain knowledge and situational framing.
      Who are you helping? What do they value?
      What's the operational environment?

  knowledge:
    type: array
    description: MCP URIs for knowledge lookup
    items:
      type: string
      pattern: "^mcp://[a-z0-9-]+/[a-z0-9-]+$"

  access:
    type: object
    description: Credential and access configuration
    properties:
      vault_role:
        type: string
        description: Vault role to assume for credentials
      ttl:
        type: string
        description: Token lifetime (session or ISO 8601 duration)
        pattern: "^(session|PT?\\d+[HMS]?)$"

  lens:
    type: string
    description: |
      System prompt fragment defining cognitive framing.
      How to approach problems, what to prioritize, what to reject.

  # === Performance Evaluation ===
  performance:
    type: object
    description: Contribution evaluation for this masque
    properties:
      score:
        type: string
        description: |
          Current contribution rating:
          + additive (steady contribution)
          - negative (detracts from goals)
          / dividing (fragments effort)
          * multiplicative (force multiplier)
          e exponential (catalytic, transformative)
        enum: ["+", "-", "/", "*", "e"]
        nullable: true
      history:
        type: array
        description: Historical performance records
        items:
          type: object
          required: [date, score]
          properties:
            date:
              type: string
              format: date-time
            score:
              type: string
              enum: ["+", "-", "/", "*", "e"]
            notes:
              type: string
              description: Evaluator notes on this rating
